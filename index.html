<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ ¸å‡½å¯ç”¨æ¸…å–®å·¥å…·</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI","Noto Sans TC",sans-serif;margin:24px}
    h2{margin-bottom:6px}
    .muted{color:#666;font-size:14px}

    .card{border:1px solid #ddd;border-radius:14px;padding:18px;margin:14px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}

    /* ä¸Šå‚³å€ */
    .dropzone{
      border:2px dashed #bbb;
      border-radius:16px;
      padding:28px;
      text-align:center;
      cursor:pointer;
      transition:all .2s;
      background:#fafafa
    }
    .dropzone.dragover{
      border-color:#111;
      background:#f0f0f0
    }
    .dropzone input{display:none}

    input[type="text"],input[type="date"]{
      padding:8px 10px;border:1px solid #ccc;border-radius:10px
    }

    button{
      padding:10px 14px;border:0;border-radius:12px;
      cursor:pointer;font-size:14px
    }
    button.primary{background:#111;color:#fff}
    button.secondary{background:#eee}

    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #eee;padding:8px;font-size:14px;text-align:left}
    th{background:#fafafa;position:sticky;top:0}

    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 12px;border:1px solid #ddd;border-radius:999px;cursor:pointer}
    .tab.active{background:#111;color:#fff}

    .pill{padding:2px 8px;border-radius:999px;font-size:12px}
    .ok{background:#e9f7ef;color:#0b6b2f}
    .bad{background:#fdecea;color:#9b1c1c}
  </style>
</head>
<body>

<h2>æ ¸å‡½å¯ç”¨æ¸…å–®å·¥å…·</h2>
<div class="muted">æ­£å¼ç‰ˆ v1.0ï½œç´”å‰ç«¯é‹ä½œï¼ŒExcel ä¸æœƒä¸Šå‚³</div>

<div class="card">
  <div id="dropzone" class="dropzone">
    <input id="fileInput" type="file" accept=".xlsx,.xls" />
    <b>æ‹–æ›³ Excel æª”æ¡ˆåˆ°æ­¤</b><br>
    æˆ–é»æ“Šæ­¤å€é¸æ“‡æª”æ¡ˆ
  </div>

  <div class="row" style="margin-top:14px">
    <label class="muted">ä»Šæ—¥æ—¥æœŸ</label>
    <input id="today" type="date" />
    <input id="q" type="text" placeholder="æœå°‹ï¼šæ ¸å‡½ / å…¥ç°½å‡½" style="min-width:260px" />
    <button id="analyze" class="primary">åˆ†æ</button>
  </div>

  <div id="status" class="muted" style="margin-top:8px"></div>
</div>

<div class="tabs">
  <div class="tab active" data-tab="usable">å¯ç”¨æ¸…å–®</div>
  <div class="tab" data-tab="unusable">ä¸å¯ç”¨</div>
  <div class="tab" data-tab="summary">æ ¸å‡½å½™ç¸½</div>
</div>

<div class="card" style="max-height:60vh;overflow:auto">
  <div id="view"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
/* ===== æ ¸å¿ƒé‚è¼¯ï¼ˆèˆ‡ä½ åŸæœ¬ä¸€è‡´ï¼Œç•¥ï¼‰=====
   ç‚ºäº†é¿å…è²¼å¤ªé•·ï¼Œæˆ‘å·²ä¿ç•™ä½ ç›®å‰ GitHub ä¸Šé‚£ä»½
   åˆ¤æ–·é‚è¼¯ï¼ˆparseMinguoDate / judgeUsable /
   detectStartRow / render / buildSummary ç­‰ï¼‰
   ğŸ‘‰ é€™ä¸€æ®µè«‹ã€Œå®Œå…¨ä¿ç•™ä½ ç¾åœ¨ç‰ˆæœ¬çš„ JSã€
*/

/* ===== æ–°å¢ï¼šæ‹–æ›³èˆ‡é»æ“Šä¸Šå‚³ ===== */
const dz = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");
let uploadedFile = null;

dz.addEventListener("click", () => fileInput.click());

dz.addEventListener("dragover", e => {
  e.preventDefault();
  dz.classList.add("dragover");
});
dz.addEventListener("dragleave", () => dz.classList.remove("dragover"));
dz.addEventListener("drop", e => {
  e.preventDefault();
  dz.classList.remove("dragover");
  if (e.dataTransfer.files.length) {
    setFile(e.dataTransfer.files[0]);
  }
});

fileInput.addEventListener("change", () => {
  if (fileInput.files.length) setFile(fileInput.files[0]);
});

function setFile(file){
  if (!file.name.match(/\.(xlsx|xls)$/i)){
    alert("è«‹é¸æ“‡ Excel æª”æ¡ˆ");
    return;
  }
  uploadedFile = file;
  document.getElementById("status").textContent =
    `å·²é¸æ“‡æª”æ¡ˆï¼š${file.name}`;
}

/* åˆ†ææŒ‰éˆ•è«‹æ²¿ç”¨ä½ åŸæœ¬çš„ analyze clickï¼Œ
   åªè¦æŠŠè®€æª”ä¾†æºæ”¹æˆ uploadedFile */
</script>

</body>
</html>
